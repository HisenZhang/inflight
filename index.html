<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>IN-FLIGHT</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css?v=8">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" href="public/favicon.svg">
    <link rel="apple-touch-icon" href="public/apple-touch-icon.svg">
</head>
<body>
    <!-- Update Notification Banner -->
    <div id="update-notification" class="update-notification">
        <div class="update-notification-content">
            <span class="update-notification-icon">ðŸ”„</span>
            <div class="update-notification-text">
                <strong id="update-version-info">UPDATE AVAILABLE</strong>
                <p id="update-release-info">A new version of IN-FLIGHT is ready</p>
            </div>
            <div class="update-notification-actions">
                <button class="btn btn-primary btn-sm" onclick="activateUpdate()">UPDATE NOW</button>
                <button class="btn btn-secondary btn-sm" onclick="dismissUpdate()">LATER</button>
            </div>
        </div>
    </div>

    <div class="container">
        <header>
            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <button class="tab-btn active" data-tab="welcome">WELCOME</button>
                <button class="tab-btn" data-tab="data">DATA</button>
                <button class="tab-btn" data-tab="route">ROUTE</button>
                <button class="tab-btn" data-tab="navlog">NAVLOG</button>
                <button class="tab-btn" data-tab="map">MAP</button>
                <button class="tab-btn" data-tab="inflight">IN-FLIGHT</button>
                <button class="tab-btn" data-tab="chklst">CHKLST</button>
                <button class="tab-btn" data-tab="stats">STATS</button>
            </div>
        </header>

        <!-- Tab: Welcome -->
        <div class="tab-content active" id="tab-welcome">
            <div class="welcome-brief">
                <h1>IN-FLIGHT</h1>
                <p class="welcome-tagline">Open source terminal-style flight planner with offline database and moving map</p>

                <div class="welcome-disclaimer">NOT FAA APPROVED â€” EDUCATIONAL USE ONLY</div>

                <div class="welcome-info">
                    <p><strong>Features:</strong> Route planning â€¢ Navigation log â€¢ Moving map â€¢ GPS tracking â€¢ Offline database</p>
                    <p><strong>Limitations:</strong> US waypoints only â€¢ No NOTAM/TFR â€¢ Data may be outdated</p>
                </div>

                <div class="welcome-actions">
                    <button class="btn btn-primary font-bold" onclick="document.querySelector('[data-tab=data]').click()">
                        GET STARTED
                    </button>
                    <button class="btn btn-secondary" onclick="startTutorial()">
                        START TUTORIAL
                    </button>
                    <button class="btn btn-secondary" onclick="window.open('https://inflight-doc.pages.dev/user-guide/', '_blank')">
                        USER GUIDE
                    </button>
                </div>
            </div>

            <!-- Install App -->
            <div class="data-section" id="pwa-install-section" style="display: none;">
                <h3 class="section-header">INSTALL APP</h3>
                <div class="data-info">
                    <p>Install IN-FLIGHT on your device for offline access, faster performance, and a native app experience.</p>
                    <p id="pwa-install-instructions" style="margin-bottom: 0;"></p>
                </div>
                <div style="text-align: center;">
                    <button class="btn btn-primary font-bold" id="pwa-install-button" onclick="handleInstallClick()">
                        ðŸ“² INSTALL NOW
                    </button>
                </div>
            </div>

            <!-- App Updates -->
            <div class="data-section">
                <h3 class="section-header">APP VERSION</h3>
                <div class="data-info">
                    <p><strong>Version:</strong> <span id="app-version">Loading...</span></p>
                    <p><strong>Cache:</strong> <span id="cache-version">Loading...</span></p>
                    <p style="margin-bottom: 0;"><strong>Build:</strong> <span id="build-date">Loading...</span></p>
                </div>
                <div style="text-align: center;">
                    <button class="btn btn-secondary" onclick="checkForUpdates()">
                        CHECK FOR UPDATES
                    </button>
                    <p id="update-check-status" style="margin-top: 8px; font-size: 0.75rem; color: var(--text-secondary);"></p>
                </div>
            </div>

            <script>
                // Populate version info once AppVersion is loaded
                if (window.AppVersion) {
                    document.getElementById('app-version').textContent = 'v' + window.AppVersion.VERSION;
                    document.getElementById('cache-version').textContent = window.AppVersion.CACHE_NAME;
                    document.getElementById('build-date').textContent = window.AppVersion.BUILD_DATE;
                }
            </script>
        </div>

        <!-- Tab: Data & Cache -->
        <div class="tab-content" id="tab-data">
            <!-- Database Section -->
            <div class="data-section">
                <h3 class="section-header">DATABASE</h3>

                <div class="check-item" id="databaseCheck">
                    <span class="check-label">STATUS</span>
                    <span class="check-status" id="databaseStatus">NOT LOADED</span>
                </div>

                <div id="dataInfo" class="data-info"></div>

                <!-- Progress Bar -->
                <div id="loadingProgress" class="progress-container" style="display: none;">
                    <div class="progress-bar-wrapper">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                    <div class="progress-text" id="progressText">Preparing...</div>
                </div>

                <div class="data-actions">
                    <button id="loadDataBtn" class="btn btn-primary font-bold">LOAD DATABASE</button>
                    <button id="reindexCacheBtn" class="btn btn-secondary" style="display: none;">REINDEX</button>
                    <button id="clearDataBtn" class="btn btn-warning" style="display: none;">CLEAR ALL</button>
                </div>

                <p class="help-text">
                    <span class="text-secondary">FAA NASR (US) + OurAirports (Worldwide)</span>
                </p>
            </div>

            <!-- Advanced Details Section (Collapsible) -->
            <div id="dataInspection" class="data-section" style="display: none;">
                <h3 class="section-header">ADVANCED</h3>
                <div id="inspectionContent" class="inspection-content"></div>
            </div>

            <!-- Flight Tracks Section -->
            <div class="data-section">
                <h3 class="section-header">FLIGHT TRACKS</h3>
                <div id="flightTracksList" class="flight-tracks-list"></div>
                <div class="data-actions">
                    <button id="refreshTracksBtn" class="btn btn-secondary">REFRESH</button>
                    <button id="clearAllTracksBtn" class="btn btn-warning" style="display: none;">CLEAR ALL TRACKS</button>
                </div>
            </div>
        </div>
        <!-- End Tab: Data & Cache -->

        <!-- Tab: Route -->
        <div class="tab-content" id="tab-route">
        <!-- Placeholder when data not loaded -->
        <div id="routePlaceholder" class="welcome-brief">
            <h2 class="font-bold text-primary" style="font-size: 1.5rem; letter-spacing: 4px; margin-bottom: 1rem;">ROUTE PLANNING</h2>
            <div class="welcome-info" style="max-width: 500px; margin: 0 auto 1.5rem auto;">
                <p>Plan your flight route with detailed waypoint-to-waypoint navigation.</p>
                <p style="margin-bottom: 0;"><strong>Supports:</strong> Direct routes â€¢ Airways â€¢ SIDs/STARs â€¢ Departure procedures â€¢ Wind calculations</p>
            </div>
            <p class="text-secondary" style="font-size: 0.75rem; margin-bottom: 1.5rem;">Load the aviation database first to enable route planning.</p>
            <button class="btn btn-primary font-bold" onclick="document.querySelector('[data-tab=data]').click()">
                LOAD DATABASE
            </button>
        </div>

        <!-- Input Section -->
        <div class="input-section" style="display: none;">
            <h2 class="font-bold text-primary">ROUTE ENTRY</h2>

            <!-- ICAO-Style Route Input (Required) -->
            <div class="route-input-icao">
                <!-- Departure Airport -->
                <div class="input-group">
                    <label class="text-sm font-medium text-secondary">DEPARTURE:</label>
                    <div class="input-wrapper">
                        <input
                            type="text"
                            id="departureInput"
                            class="font-medium route-field"
                            placeholder="KALB"
                            maxlength="6"
                            autocomplete="off"
                            disabled
                        >
                        <div id="departureAutocompleteDropdown" class="autocomplete-dropdown"></div>
                    </div>
                </div>

                <!-- Route (Optional) -->
                <div class="input-group">
                    <label class="text-sm font-medium text-secondary">ROUTE:</label>
                    <div class="input-wrapper">
                        <input
                            type="text"
                            id="routeInput"
                            class="font-medium route-field"
                            placeholder="PAYGE Q822 FNT WYNDE3 (or leave blank for DCT)"
                            autocomplete="off"
                            disabled
                        >
                        <div id="autocompleteDropdown" class="autocomplete-dropdown"></div>
                    </div>
                </div>

                <!-- Destination Airport -->
                <div class="input-group">
                    <label class="text-sm font-medium text-secondary">DESTINATION:</label>
                    <div class="input-wrapper">
                        <input
                            type="text"
                            id="destinationInput"
                            class="font-medium route-field"
                            placeholder="KORD"
                            maxlength="6"
                            autocomplete="off"
                            disabled
                        >
                        <div id="destinationAutocompleteDropdown" class="autocomplete-dropdown"></div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="button-row">
                    <button id="calculateBtn" class="btn btn-primary font-bold" disabled>CALCULATE</button>
                    <button id="clearRouteBtn" class="btn btn-secondary">CLEAR</button>
                </div>
            </div>
            <p class="help-text mb-md">
                Airports (ICAO), NavAids, Fixes, Airways, SID/STAR. Route is optional - leave blank for direct (DCT).
            </p>

            <!-- Optional Features -->
            <div class="optional-features">
                <p class="text-secondary text-sm mb-sm">OPTIONAL FEATURES:</p>

                <!-- Wind Correction & Time Estimation -->
                <div class="feature-toggle">
                    <div class="checkbox-toggle" id="enableWindsToggle"></div>
                    <label class="font-medium" style="cursor: pointer;">WIND CORRECTION & TIME</label>
                    <span class="help-text-inline">- winds aloft, WCA, ground speed, ETA</span>
                </div>
                <div id="windInputs" class="feature-inputs hidden">
                    <div class="input-row">
                        <label class="text-sm font-medium">CRUISE ALTITUDE (FT MSL):</label>
                        <input
                            type="number"
                            id="altitudeInput"
                            class="font-medium"
                            placeholder="e.g. 5500"
                            min="0"
                            max="45000"
                            step="100"
                            value="5500"
                            disabled
                        >
                    </div>
                    <div class="input-row">
                        <label class="text-sm font-medium">TRUE AIRSPEED (KT):</label>
                        <input
                            type="number"
                            id="tasInput"
                            class="font-medium"
                            placeholder="e.g. 120"
                            min="0"
                            max="500"
                            step="5"
                            disabled
                        >
                    </div>
                    <div class="input-row">
                        <label class="text-sm font-medium">FORECAST PERIOD:</label>
                        <div class="radio-group">
                            <div class="radio-btn selected" data-period="06">6 HR</div>
                            <div class="radio-btn" data-period="12">12 HR</div>
                            <div class="radio-btn" data-period="24">24 HR</div>
                        </div>
                    </div>
                    <p class="help-text mt-sm">
                        Wind data requires internet access
                    </p>
                </div>

                <!-- Fuel Planning -->
                <div class="feature-toggle">
                    <div class="checkbox-toggle" id="enableFuelToggle"></div>
                    <label class="font-medium" style="cursor: pointer;">FUEL PLANNING</label>
                    <span class="help-text-inline">- calculate fuel burn and reserves</span>
                </div>
                <div id="fuelInputs" class="feature-inputs hidden">
                    <div class="input-row">
                        <label class="text-sm font-medium">USABLE FUEL (GAL):</label>
                        <input
                            type="number"
                            id="usableFuelInput"
                            class="font-medium"
                            placeholder="e.g. 32"
                            min="0"
                            max="500"
                            step="1"
                            value="32"
                            disabled
                        >
                    </div>
                    <div class="input-row">
                        <label class="text-sm font-medium">TAXI FUEL (GAL):</label>
                        <input
                            type="number"
                            id="taxiFuelInput"
                            class="font-medium"
                            placeholder="e.g. 1"
                            min="0"
                            max="10"
                            step="0.1"
                            value="1"
                            disabled
                        >
                    </div>
                    <div class="input-row">
                        <label class="text-sm font-medium">BURN RATE (GAL/HR):</label>
                        <input
                            type="number"
                            id="burnRateInput"
                            class="font-medium"
                            placeholder="e.g. 10"
                            min="0"
                            max="50"
                            step="0.5"
                            value="10"
                            disabled
                        >
                    </div>
                    <div class="input-row">
                        <label class="text-sm font-medium">FUEL RESERVE:</label>
                        <div class="radio-group">
                            <div class="radio-btn selected" data-reserve="30">VFR DAY (30 MIN)</div>
                            <div class="radio-btn" data-reserve="45">VFR NIGHT / IFR (45 MIN)</div>
                        </div>
                    </div>
                    <p class="help-text mt-sm">
                        Requires WIND CORRECTION & TIME to be enabled
                    </p>
                </div>

                <!-- Keep Screen Awake -->
                <div class="feature-toggle">
                    <div class="checkbox-toggle" id="enableWakeLockToggle"></div>
                    <label class="font-medium" style="cursor: pointer;">KEEP SCREEN AWAKE</label>
                    <span class="help-text-inline">- prevent screen from sleeping during flight</span>
                </div>
            </div>

            <!-- Query History -->
            <div id="queryHistory" class="query-history" style="display: none;">
                <div class="history-label font-medium">RECENT ROUTES:</div>
                <div id="historyList" class="history-list"></div>
            </div>
        </div>
        </div>
        <!-- End Tab: Route -->

        <!-- Tab: Navlog -->
        <div class="tab-content" id="tab-navlog">
        <!-- Placeholder when no route calculated -->
        <div id="navlogPlaceholder" class="welcome-brief">
            <h2 class="font-bold text-primary" style="font-size: 1.5rem; letter-spacing: 4px; margin-bottom: 1rem;">NAVIGATION LOG</h2>
            <div class="welcome-info" style="max-width: 500px; margin: 0 auto 1.5rem auto;">
                <p>The navigation log displays your calculated flight plan with detailed leg-by-leg information.</p>
                <p style="margin-bottom: 0;"><strong>Includes:</strong> Waypoints â€¢ Courses â€¢ Distances â€¢ Time estimates â€¢ Wind correction â€¢ Fuel calculations</p>
            </div>
            <p class="text-secondary" style="font-size: 0.75rem;">Calculate a route in the ROUTE tab to see your navigation log here.</p>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="results-section" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                <h2 class="font-bold text-primary">NAVIGATION LOG</h2>
                <div class="navlog-actions">
                    <button id="exportNavlogBtn" class="btn btn-secondary btn-sm">EXPORT</button>
                    <button id="importNavlogBtn" class="btn btn-secondary btn-sm">IMPORT</button>
                    <input type="file" id="importNavlogInput" accept=".json" style="display: none;">
                </div>
            </div>
            <div id="routeSummary" class="route-summary"></div>

            <!-- Wind Altitude Table (shown when wind correction enabled) -->
            <div id="windAltitudeTable" class="wind-altitude-table" style="display: none;"></div>

            <div id="navlogTable" class="navlog-table"></div>
        </div>
        </div>
        <!-- End Tab: Navlog -->

        <!-- Tab: Vector Map -->
        <div class="tab-content" id="tab-map">
        <!-- Placeholder when no route calculated -->
        <div id="mapPlaceholder" class="welcome-brief">
            <h2 class="font-bold text-primary" style="font-size: 1.5rem; letter-spacing: 4px; margin-bottom: 1rem;">INTERACTIVE MAP</h2>
            <div class="welcome-info" style="max-width: 500px; margin: 0 auto 1.5rem auto;">
                <p>The interactive map displays your flight route with a visual representation of waypoints, airways, and procedures.</p>
                <p style="margin-bottom: 0;"><strong>Features:</strong> Pan & zoom â€¢ GPS tracking â€¢ Real-time navigation data â€¢ Multiple zoom modes</p>
            </div>
            <p class="text-secondary" style="font-size: 0.75rem;">Calculate a route in the ROUTE tab to see your flight path visualized here.</p>
        </div>

        <!-- Vector Map Display -->
        <div id="mapDisplay" class="map-display" style="display: none;">
            <div class="map-header">
                <div class="zoom-controls">
                    <button class="zoom-btn active" data-zoom="full">ROUTE</button>
                    <button class="zoom-btn" data-zoom="destination">DEST</button>
                    <button class="zoom-btn" data-zoom="surrounding-50">50NM</button>
                    <button class="zoom-btn" data-zoom="surrounding-25">25NM</button>
                    <button class="zoom-btn" id="zoomOutBtn">âˆ’</button>
                    <button class="zoom-btn" id="zoomInBtn">+</button>
                </div>
            </div>

            <div id="mapContainer" class="map-container"></div>

            <!-- Map Info Status Bar -->
            <div id="mapStatusBar" class="map-status-bar hidden">
                <table class="navlog-table" style="width: 100%; margin: 0;">
                    <tbody id="statusBarContent"></tbody>
                </table>
            </div>

            <!-- Navigation Panel -->
            <div id="navigationPanel" class="navigation-panel">
                <div id="navigationContent" class="navigation-content">
                    <!-- Primary row: WPT, HDG, DIST, ETE -->
                    <div class="nav-primary-row">
                        <div class="nav-item">
                            <span class="nav-label">WPT</span>
                            <span class="nav-value next-wp"></span>
                        </div>
                        <div class="nav-item">
                            <span class="nav-label">HDG</span>
                            <span class="nav-value req-hdg"></span>
                        </div>
                        <div class="nav-item">
                            <span class="nav-label">DIST</span>
                            <span class="nav-value dist-nm"></span>
                        </div>
                        <div class="nav-item">
                            <span class="nav-label">ETE</span>
                            <span class="nav-value ete-value"></span>
                        </div>
                    </div>

                    <!-- Secondary row: GS, ETA, H-ACC, V-ACC -->
                    <div class="nav-secondary-row">
                        <div class="nav-item">
                            <span class="nav-label">GS</span>
                            <span class="nav-value gs-value"></span>
                        </div>
                        <div class="nav-item">
                            <span class="nav-label">ETA</span>
                            <span class="nav-value eta-time"></span>
                        </div>
                        <div class="nav-item">
                            <span class="nav-label">H-ACC</span>
                            <span class="nav-value gps-horiz-acc text-secondary">--</span>
                        </div>
                        <div class="nav-item">
                            <span class="nav-label">V-ACC</span>
                            <span class="nav-value gps-vert-acc text-secondary">--</span>
                        </div>
                    </div>

                    <!-- Navigation buttons -->
                    <div class="nav-buttons-row">
                        <button class="btn btn-secondary" id="prevNavWptBtn">â—„ PREV</button>
                        <button class="btn btn-secondary" id="nextNavWptBtn">NEXT â–º</button>
                    </div>
                </div>
            </div>
        </div>
        </div>
        <!-- End Tab: Map -->

        <!-- Tab: IN-FLIGHT -->
        <div class="tab-content" id="tab-inflight">
        <!-- Placeholder when not in flight -->
        <div id="inflightPlaceholder" class="welcome-brief">
            <h2 class="font-bold text-primary" style="font-size: 1.5rem; letter-spacing: 4px; margin-bottom: 1rem;">IN-FLIGHT AWARENESS</h2>
            <div class="welcome-info" style="max-width: 500px; margin: 0 auto 1.5rem auto;">
                <p>Real-time situational awareness during flight with current weather conditions, fuel status, and nearby airports for diversion.</p>
                <p style="margin-bottom: 0;"><strong>Includes:</strong> Fuel remaining â€¢ Wind/temperature â€¢ Potential hazards â€¢ Nearest airports â€¢ ETE calculations</p>
            </div>
            <p class="text-secondary" style="font-size: 0.75rem; margin-bottom: 1.5rem;">GPS and flight plan required. This tab updates automatically when you're in flight.</p>
            <p class="text-secondary" style="font-size: 0.75rem;">Enable GPS tracking and calculate a route with wind/fuel enabled to see in-flight data.</p>
        </div>

        <!-- In-Flight Display -->
        <div id="inflightDisplay" class="inflight-display" style="display: none;">
            <h2 class="font-bold text-primary">IN-FLIGHT AWARENESS</h2>

            <!-- Current Position & Status -->
            <div class="stats-card">
                <h3 class="stats-card-title">CURRENT POSITION</h3>
                <div class="stats-grid-compact">
                    <div class="stat-item">
                        <span class="stat-label">LAT</span>
                        <span class="stat-value text-metric" id="if-lat">--</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">LON</span>
                        <span class="stat-value text-metric" id="if-lon">--</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">ALT</span>
                        <span class="stat-value text-metric" id="if-alt">-- FT</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">GS</span>
                        <span class="stat-value text-metric" id="if-gs">-- KT</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">HDG</span>
                        <span class="stat-value text-metric" id="if-hdg">--Â°</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">TIME</span>
                        <span class="stat-value text-secondary" id="if-time">--:--</span>
                    </div>
                </div>
            </div>

            <!-- Fuel Status -->
            <div class="stats-card" id="if-fuel-card">
                <h3 class="stats-card-title">FUEL STATUS</h3>
                <div class="stats-grid-compact">
                    <div class="stat-item">
                        <span class="stat-label">REM</span>
                        <span class="stat-value text-metric" id="if-fuel-rem">-- GAL</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">ENDUR</span>
                        <span class="stat-value text-metric" id="if-fuel-endur">--:--</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">RANGE</span>
                        <span class="stat-value text-metric" id="if-fuel-range">-- NM</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">USED</span>
                        <span class="stat-value text-secondary" id="if-fuel-used">-- GAL</span>
                    </div>
                </div>
            </div>

            <!-- Weather at Current Location -->
            <div class="stats-card">
                <h3 class="stats-card-title">WEATHER AT POSITION</h3>
                <div class="stats-grid-compact">
                    <div class="stat-item">
                        <span class="stat-label">WIND DIR</span>
                        <span class="stat-value text-metric" id="if-wind-dir">--Â°</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">WIND SPD</span>
                        <span class="stat-value text-metric" id="if-wind-spd">-- KT</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">TEMP</span>
                        <span class="stat-value text-metric" id="if-temp">--Â°C</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">H-WIND</span>
                        <span class="stat-value text-secondary" id="if-headwind">-- KT</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">X-WIND</span>
                        <span class="stat-value text-secondary" id="if-crosswind">-- KT</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">STATUS</span>
                        <span class="stat-value" id="if-wind-status">FORECAST</span>
                    </div>
                </div>
            </div>

            <!-- Hazard Warnings -->
            <div class="stats-card" id="if-hazards-card" style="display: none;">
                <h3 class="stats-card-title text-warning">POTENTIAL HAZARDS</h3>
                <div id="if-hazards-list" class="hazards-list"></div>
            </div>

            <!-- Nearest Airports -->
            <div class="stats-card">
                <h3 class="stats-card-title">NEAREST AIRPORTS (DIVERSION)</h3>
                <div id="if-airports-table" class="navlog-table"></div>
                <p class="help-text mt-sm text-secondary">
                    Showing towered airports within 50 NM, sorted by distance
                </p>
            </div>
        </div>
        </div>
        <!-- End Tab: IN-FLIGHT -->

        <!-- Tab: Checklist -->
        <div class="tab-content" id="tab-chklst">
            <div class="checklist-section">
                <h2 class="font-bold text-primary">PIPER CHEROKEE 140 CHECKLIST</h2>

                <!-- Before Start -->
                <div class="checklist-card" data-section="0">
                    <h3 class="checklist-title checklist-title-collapsible">
                        <span>BEFORE START</span>
                        <span class="checklist-chevron">â–¼</span>
                    </h3>
                    <div class="checklist-items">
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Passenger / crew briefing - COMPLETE</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Fuel selector - DESIRED TANK</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Mixture - FULL RICH</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Throttle - OPEN 1/4"</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Carb heat - OFF</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Avionics - OFF</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Beacon - ON</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Circuit breakers - IN</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Parking brake - SET</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Seatbelts - FASTENED</span>
                        </div>
                    </div>
                </div>

                <!-- Engine Start -->
                <div class="checklist-card collapsed" data-section="1">
                    <h3 class="checklist-title checklist-title-collapsible">
                        <span>ENGINE START</span>
                        <span class="checklist-chevron">â–º</span>
                    </h3>
                    <div class="checklist-items" style="display: none;">
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Master switch - ON</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Fuel pump - ON</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Prime - AS REQUIRED</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Prop area - CLEAR</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Starter - ENGAGE</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Throttle - 1000 RPM</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Oil pressure - CHECK</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Fuel pump - OFF</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Engine instruments - CHECK</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Mixture - AS REQUIRED</span>
                        </div>
                    </div>
                </div>

                <!-- Before Taxi -->
                <div class="checklist-card collapsed" data-section="2">
                    <h3 class="checklist-title checklist-title-collapsible">
                        <span>BEFORE TAXI</span>
                        <span class="checklist-chevron">â–º</span>
                    </h3>
                    <div class="checklist-items" style="display: none;">
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Avionics / radios - ON / SET</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Instruments - CHECKED / SET</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Lights - AS REQUIRED</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Parking brake - RELEASE</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Brakes - TEST</span>
                        </div>
                    </div>
                </div>

                <!-- Run-up -->
                <div class="checklist-card collapsed" data-section="3">
                    <h3 class="checklist-title checklist-title-collapsible">
                        <span>RUN-UP</span>
                        <span class="checklist-chevron">â–º</span>
                    </h3>
                    <div class="checklist-items" style="display: none;">
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Parking brake - SET</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Flight controls - FREE / CORRECT</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Fuel selector - OPPOSITE TANK</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Mixture - FULL RICH</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Throttle - 2000 RPM</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Magnetos (125 / 50) - CHECK</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Carb heat - TEST</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Engine instruments - CHECK</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Annunciator lights - CHECK</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Ammeter - CHECK</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Throttle - IDLE</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Carb heat - TEST</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Throttle - 1000 RPM</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Mixture - AS REQUIRED</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Parking brake - AS REQUIRED</span>
                        </div>
                    </div>
                </div>

                <!-- Before Takeoff -->
                <div class="checklist-card collapsed" data-section="4">
                    <h3 class="checklist-title checklist-title-collapsible">
                        <span>BEFORE TAKEOFF</span>
                        <span class="checklist-chevron">â–º</span>
                    </h3>
                    <div class="checklist-items" style="display: none;">
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Briefing - COMPLETE</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Seatbelts - FASTENED</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Cabin doors - CLOSED / LOCKED</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Elevator trim - SET</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Flaps - AS REQUIRED</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Instruments / radios - SET</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Fuel pump - ON</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Lights - ON</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Pitot heat - AS REQUIRED</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Mixture - FULL RICH</span>
                        </div>
                    </div>
                </div>

                <!-- Climb -->
                <div class="checklist-card collapsed" data-section="5">
                    <h3 class="checklist-title checklist-title-collapsible">
                        <span>CLIMB</span>
                        <span class="checklist-chevron">â–º</span>
                    </h3>
                    <div class="checklist-items" style="display: none;">
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Flaps - RETRACT</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Climb power - SET</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Mixture - AS REQUIRED</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Fuel pump - OFF</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Landing light - OFF</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Engine instruments - CHECK</span>
                        </div>
                    </div>
                </div>

                <!-- Cruise -->
                <div class="checklist-card collapsed" data-section="6">
                    <h3 class="checklist-title checklist-title-collapsible">
                        <span>CRUISE</span>
                        <span class="checklist-chevron">â–º</span>
                    </h3>
                    <div class="checklist-items" style="display: none;">
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Cruise power - SET</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Elevator trim - SET</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Mixture - LEAN</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Engine instruments - MONITOR</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Fuel quantity - MONITOR</span>
                        </div>
                    </div>
                </div>

                <!-- Descent -->
                <div class="checklist-card collapsed" data-section="7">
                    <h3 class="checklist-title checklist-title-collapsible">
                        <span>DESCENT</span>
                        <span class="checklist-chevron">â–º</span>
                    </h3>
                    <div class="checklist-items" style="display: none;">
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Briefing - COMPLETE</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Seatbelts - FASTENED</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Fuel selector - DESIRED TANK</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Fuel pump - ON</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Lights - ON</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Pitot heat - AS REQUIRED</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Carb heat - AS REQUIRED</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Mixture - FULL RICH</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Instruments - SET</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Brakes - TEST</span>
                        </div>
                    </div>
                </div>

                <!-- After Landing -->
                <div class="checklist-card collapsed" data-section="8">
                    <h3 class="checklist-title checklist-title-collapsible">
                        <span>AFTER LANDING</span>
                        <span class="checklist-chevron">â–º</span>
                    </h3>
                    <div class="checklist-items" style="display: none;">
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Fuel pump - OFF</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Lights - AS REQUIRED</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Pitot heat - OFF</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Carb heat - OFF</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Mixture - AS REQUIRED</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Flaps - UP</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Elevator trim - SET TAKEOFF</span>
                        </div>
                    </div>
                </div>

                <!-- Shutdown -->
                <div class="checklist-card collapsed" data-section="9">
                    <h3 class="checklist-title checklist-title-collapsible">
                        <span>SHUTDOWN</span>
                        <span class="checklist-chevron">â–º</span>
                    </h3>
                    <div class="checklist-items" style="display: none;">
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Parking brake - SET</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Avionics - OFF</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Throttle - 1000 RPM</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Mixture - IDLE CUTOFF</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Ignition switch - OFF</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Lights - OFF</span>
                        </div>
                        <div class="checklist-item">
                            <div class="checkbox-toggle checklist-checkbox"></div>
                            <span>Master switch - OFF</span>
                        </div>
                    </div>
                </div>

                <div class="checklist-actions">
                    <button class="btn btn-secondary" id="resetChecklistBtn">RESET ALL</button>
                </div>

                <p class="help-text mt-md text-center">
                    <span class="text-secondary">*This checklist is not intended to replace manufacturer procedures*</span>
                </p>
            </div>
        </div>
        <!-- End Tab: Checklist -->

        <!-- Tab: Stats -->
        <div class="tab-content" id="tab-stats">
            <div class="stats-section">
                <h2 class="font-bold text-primary">FLIGHT STATISTICS</h2>

                <!-- Flight Status (Most Important) -->
                <div class="stats-card">
                    <div class="stat-item-large">
                        <span class="stat-label">STATUS</span>
                        <span class="stat-value" id="flightStatus">ON GROUND</span>
                    </div>
                </div>

                <!-- System Status -->
                <div class="stats-card">
                    <h3 class="stats-card-title">SYSTEM</h3>
                    <div class="stats-grid-compact">
                        <div class="stat-item">
                            <span class="stat-label">INTERNET</span>
                            <span class="stat-value" id="internetStatus">CHECKING...</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">GPS H-ACC</span>
                            <span class="stat-value" id="gpsHorizStatus">--</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">GPS V-ACC</span>
                            <span class="stat-value" id="gpsVertStatus">--</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">GPS STATUS</span>
                            <span class="stat-value" id="gpsStatus">CHECKING...</span>
                        </div>
                    </div>
                </div>

                <!-- Fuel Statistics (Critical for safety) -->
                <div class="stats-card" id="fuelStatsCard" style="display: none;">
                    <h3 class="stats-card-title">FUEL</h3>
                    <div class="stats-grid-compact">
                        <div class="stat-item">
                            <span class="stat-label">REM</span>
                            <span class="stat-value" id="fuelRemaining">-- GAL</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">ENDUR</span>
                            <span class="stat-value" id="endurance">--:--</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">USED</span>
                            <span class="stat-value" id="fuelUsed">-- GAL</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">START</span>
                            <span class="stat-value text-secondary" id="fuelOnBoard">-- GAL</span>
                        </div>
                    </div>
                </div>

                <!-- Flight Time & Performance -->
                <div class="stats-card">
                    <h3 class="stats-card-title">FLIGHT TIME</h3>
                    <div class="stats-grid-compact">
                        <div class="stat-item">
                            <span class="stat-label">TIME</span>
                            <span class="stat-value text-metric" id="flightTime">--:--:--</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">T/O</span>
                            <span class="stat-value text-secondary" id="takeoffTime">--:--</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">AVG GS</span>
                            <span class="stat-value text-metric" id="avgGroundSpeed">-- KT</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">DIST</span>
                            <span class="stat-value text-metric" id="distanceFlown">-- NM</span>
                        </div>
                    </div>
                </div>

                <!-- GPS Track Recording -->
                <div class="stats-card">
                    <h3 class="stats-card-title">GPS TRACK</h3>
                    <div class="stats-grid-compact">
                        <div class="stat-item">
                            <span class="stat-label">MODE</span>
                            <span class="stat-value" id="trackMode">AUTO</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">REC</span>
                            <span class="stat-value" id="recordingStatus">INACTIVE</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">PTS</span>
                            <span class="stat-value" id="trackPoints">0</span>
                        </div>
                    </div>
                    <div class="stats-actions mt-sm">
                        <button class="btn btn-secondary btn-sm" id="toggleModeBtn">MANUAL</button>
                        <button class="btn btn-primary btn-sm" id="startRecBtn" style="display: none;">START</button>
                        <button class="btn btn-warning btn-sm" id="stopRecBtn" style="display: none;">STOP</button>
                    </div>
                    <div class="stats-actions mt-sm">
                        <button class="btn btn-secondary btn-sm" id="exportTrackBtn">EXPORT</button>
                        <button class="btn btn-warning btn-sm" id="clearTrackBtn">CLEAR</button>
                    </div>
                </div>

                <!-- Manual Time Entry (Logbook) -->
                <div class="stats-card">
                    <h3 class="stats-card-title">LOGBOOK TIMES</h3>
                    <div class="time-entry-grid">
                        <div class="time-entry-item">
                            <label class="stat-label">HOBBS START</label>
                            <input type="number" id="hobbsStart" class="time-input" placeholder="0.0" step="0.1" min="0">
                        </div>
                        <div class="time-entry-item">
                            <label class="stat-label">HOBBS END</label>
                            <input type="number" id="hobbsEnd" class="time-input" placeholder="0.0" step="0.1" min="0">
                        </div>
                        <div class="time-entry-item">
                            <label class="stat-label">HOBBS TOTAL</label>
                            <span class="stat-value" id="hobbsTotal">-- HR</span>
                        </div>
                    </div>
                    <div class="time-entry-grid mt-md">
                        <div class="time-entry-item">
                            <label class="stat-label">TACH START</label>
                            <input type="number" id="tachStart" class="time-input" placeholder="0.0" step="0.1" min="0">
                        </div>
                        <div class="time-entry-item">
                            <label class="stat-label">TACH END</label>
                            <input type="number" id="tachEnd" class="time-input" placeholder="0.0" step="0.1" min="0">
                        </div>
                        <div class="time-entry-item">
                            <label class="stat-label">TACH TOTAL</label>
                            <span class="stat-value" id="tachTotal">-- HR</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Tab: Stats -->

    </div>

    <!-- PWA Install Banner -->
    <div id="pwa-install-banner" class="pwa-install-banner">
        <div class="pwa-install-content">
            <span class="pwa-install-icon">ðŸ“²</span>
            <div class="pwa-install-text">
                <strong>INSTALL IN-FLIGHT</strong>
                <p>Add to home screen for offline access & better performance</p>
            </div>
            <div class="pwa-install-actions">
                <button class="btn-install" onclick="handleInstallClick()">INSTALL</button>
                <button class="btn-dismiss" onclick="handleInstallDismiss()">NOT NOW</button>
            </div>
        </div>
        <div id="pwa-install-status"></div>
    </div>

    <!-- Scripts - Load modules in order (3-Engine Architecture) -->

    <!-- Version Configuration (loaded first) -->
    <script src="version.js"></script>                  <!-- Centralized version management -->
    <script src="ui/pwa-install.js"></script>           <!-- PWA install UI handler -->

    <!-- External Libraries -->
    <script src="lib/geodesy.js"></script>              <!-- WGS84 + WMM2025 library -->
    <script src="lib/wind-stations.js"></script>        <!-- Wind station data -->

    <!-- Utilities Layer -->
    <script src="utils/formatters.js"></script>         <!-- Shared formatting utilities -->
    <script src="utils/compression.js"></script>        <!-- CSV compression utilities -->
    <script src="utils/wake-lock.js"></script>          <!-- Screen wake lock manager -->

    <!-- Data Engine -->
    <script src="data/nasr-adapter.js"></script>        <!-- NASR data adapter (primary) -->
    <script src="data/ourairports-adapter.js"></script> <!-- OurAirports adapter (fallback) -->
    <script src="data/data-manager.js"></script>        <!-- Data loading & caching orchestrator -->

    <!-- Compute Engine -->
    <script src="compute/winds-aloft.js"></script>      <!-- Wind data fetching & interpolation -->
    <script src="compute/route-lexer.js"></script>      <!-- Route tokenization (NEW) -->
    <script src="compute/route-parser.js"></script>     <!-- Route parsing (NEW) -->
    <script src="compute/route-resolver.js"></script>   <!-- Semantic analysis (NEW) -->
    <script src="compute/route-engine.js"></script>     <!-- Route parsing orchestrator (NEW) -->
    <script src="compute/route-expander.js"></script>   <!-- Airway/STAR/DP expansion module -->
    <script src="compute/route-calculator.js"></script> <!-- Navigation calculations module -->
    <script src="compute/query-engine.js"></script>     <!-- Spatial queries & search -->

    <!-- State Management -->
    <script src="state/flight-state.js"></script>       <!-- Flight plan & navigation state -->
    <script src="state/flight-tracker.js"></script>     <!-- Flight time & GPS tracking -->

    <!-- Display Layer -->
    <script src="display/ui-controller.js"></script>       <!-- UI interactions module -->
    <script src="display/stats-controller.js"></script>    <!-- Stats tab controller -->
    <script src="display/inflight-controller.js"></script> <!-- IN-FLIGHT tab controller -->
    <script src="display/checklist-controller.js"></script><!-- Checklist tab controller -->
    <script src="display/map-display.js"></script>    <!-- Vector map & GPS tracking -->
    <script src="display/app.js"></script>                 <!-- Main application coordinator -->
    <script src="ui/tutorial.js"></script>                 <!-- Interactive tutorial system -->
</body>
</html>
