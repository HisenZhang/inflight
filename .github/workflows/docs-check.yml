name: Documentation Check

on:
  push:
    branches: [ main ]
    paths:
      - 'docs/**'
  pull_request:
    branches: [ main ]
    paths:
      - 'docs/**'

jobs:
  check-docs:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Check documentation structure
      run: |
        echo "Checking docs/ directory structure..."
        ls -la docs/

        echo "Checking for required files..."
        test -f docs/index.md || (echo "Missing docs/index.md" && exit 1)
        test -f docs/README.md || (echo "Missing docs/README.md" && exit 1)
        test -f docs/.vitepress/config.mts || (echo "Missing docs/.vitepress/config.mts" && exit 1)

        echo "Checking user guide..."
        test -d docs/user-guide || (echo "Missing docs/user-guide/" && exit 1)
        test -f docs/user-guide/index.md || (echo "Missing docs/user-guide/index.md" && exit 1)

        echo "Checking developer guide..."
        test -d docs/developer || (echo "Missing docs/developer/" && exit 1)

        echo "âœ… All required documentation files present!"

    - name: Validate VitePress structure
      run: |
        echo "Checking VitePress configuration..."

        # Verify VitePress config exists
        test -f docs/.vitepress/config.mts || (echo "Missing VitePress config" && exit 1)

        # Check for theme files
        test -d docs/.vitepress/theme || (echo "Missing VitePress theme directory" && exit 1)

        echo "âœ… VitePress structure validated!"

    - name: Test VitePress build
      run: |
        echo "Installing dependencies..."
        npm ci

        echo "Building documentation..."
        npm run docs:build

        echo "Checking build output..."
        test -d docs/.vitepress/dist || (echo "Build output missing" && exit 1)
        test -f docs/.vitepress/dist/index.html || (echo "Missing index.html in build" && exit 1)

        echo "âœ… VitePress build successful!"

    - name: Summary
      run: |
        echo "ðŸ“š Documentation structure:"
        tree -L 2 docs/ || find docs/ -type d -maxdepth 2

        echo ""
        echo "âœ… All documentation checks passed!"
        echo "ðŸš€ Ready for Cloudflare Pages deployment"
